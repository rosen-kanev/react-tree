!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("react-virtual"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","react-virtual","prop-types"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactTree={},e.React,e.ReactVirtual)}(this,(function(e,t,n){"use strict";function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}const d=()=>{},i=e=>"function"==typeof e,a=e=>void 0===e,l=(e,t)=>{const n=t.split("-");let r={nodes:e},d=0;for(;null!=r&&d<n.length;)r=r.nodes[n[d++]];return d&&d===n.length?r:void 0},s=(e,t)=>{const n=t.split("-");return n.length>1?l(e,n.slice(0,-1).join("-")):null},o=e=>{const t=e.getAttribute("aria-expanded");return{isExpandable:null!==t,isExpanded:"true"===t}},c=(e,t)=>{const n=t.split("-");return 1===n.length&&parseInt(n[0],10)===e.length-1},u=(e,t,n)=>{if(Object.is(e,t))return!0;const r=Object.keys(e).filter((e=>!n.includes(e))),d=Object.keys(t).filter((e=>!n.includes(e)));if(r.length!==d.length)return!1;for(const n of r)if(!Object.prototype.hasOwnProperty.call(t,n)||!Object.is(e[n],t[n]))return!1;return!0},f=Symbol("id"),p=(e,t)=>{let n=[],r=e.length-1;for(;r>=0;)n.push({...e[r],[f]:t?`${t}-${r}`:`${r}`}),r--;return n},g=e=>{let{node:n,index:r,selected:d,focused:a,expanded:l,setSize:s,counter:o,onItemSelect:c,renderLabel:u,onKeyDown:f}=e;const p=n.nodes.length>0,g=p?l.includes(n.id):null,x=r.split("-"),m=parseInt(x[x.length-1],10)+1,E=t.useRef();return t.useEffect((()=>{o>0&&a===n.id&&E.current&&(E.current.focus(),E.current.firstElementChild.scrollIntoView({block:"nearest"}))}),[o]),React.createElement("li",{ref:E,role:"treeitem",tabIndex:a===n.id?0:-1,"aria-expanded":g,"aria-selected":d===n.id||null,"aria-level":x.length,"aria-posinset":m,"aria-setsize":s,"data-index":r,onKeyDown:f},i(u)?u(n,{isExpandable:p,isExpanded:g}):React.createElement("div",{onClick:()=>c(n)},n.label),g&&p&&React.createElement("ul",{role:"group"},n.nodes.map(((e,t)=>React.createElement(h,{key:e.id,node:e,index:r+"-"+t,selected:d,focused:a,expanded:l,setSize:n.nodes.length,counter:o,renderLabel:u,onItemSelect:c,onKeyDown:f})))))},x=(e,t)=>{if(!u(e,t,["counter","selected","focused","expanded","onItemSelect","onKeyDown"]))return!1;const n=[{...t.node,nodes:[]},...t.node.nodes];for(;n.length;){const r=n.shift();if(r.id===t.focused||r.id===e.focused)return!1;if(r.id===t.selected||r.id===e.selected)return!1;if(e.expanded.includes(r.id)!==t.expanded.includes(r.id))return!1;n.push(...r.nodes)}return!0},h=t.memo(g,x);var m=h;var E=(e,n)=>{const[r,d]=t.useState(n),i=a(e),l=i?r:e;return[l,t.useCallback((e=>{i&&d(e)}),[i,l])]};const y=(e,n)=>{let{nodes:i,defaultFocused:u,focused:f,onFocusChange:p=d,defaultExpanded:g=[],expanded:x,onExpandChange:h=d,selectionTogglesExpanded:y=!0,selectionFollowsFocus:b,defaultSelected:v,selected:S,onSelectChange:I=d,renderLabel:T,...w}=e;const R=a(f)?a(u)&&i.length>0?i[0].id:u:void 0,[k,D]=E(f,R),[K,C]=E(x,g),[z,j]=E(S,v),[O,A]=t.useState(0);t.useImperativeHandle(n,(()=>({focus(){A((e=>e+1))}})));const F=e=>{if(i.length&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&e.target===e.currentTarget)if("ArrowUp"===e.key){if(e.preventDefault(),"0"!==e.currentTarget.dataset.index)if(e.currentTarget.previousElementSibling){let t=e.currentTarget.previousElementSibling;for(;;){const{isExpanded:e,isExpandable:n}=o(t);if(!n||!e)break;t=t.lastElementChild.lastElementChild}const n=l(i,t.dataset.index);L(n)}else{const t=s(i,e.currentTarget.dataset.index);t&&L(t)}}else if("ArrowDown"===e.key){e.preventDefault();const{isExpanded:t}=o(e.currentTarget);if(t){const t=l(i,e.currentTarget.dataset.index);L(t.nodes[0])}else{let t=e.currentTarget;for(;!c(i,t.dataset.index);){if(t.nextElementSibling){t=t.nextElementSibling;break}t=t.parentElement.parentElement}t!==e.currentTarget&&L(l(i,t.dataset.index))}}else if("ArrowLeft"===e.key){e.preventDefault();const{isExpandable:t,isExpanded:n}=o(e.currentTarget);if(t&&n){const t=l(i,e.currentTarget.dataset.index);C((e=>e.filter((e=>e!==t.id)))),h(t)}else{const t=s(i,e.currentTarget.dataset.index);t&&L(t)}}else if("ArrowRight"===e.key){e.preventDefault();const{isExpandable:t,isExpanded:n}=o(e.currentTarget);if(t){const t=l(i,e.currentTarget.dataset.index);if(n){const e=t.nodes[0];L(e)}else C((e=>e.concat(t.id))),h(t)}}else if("Enter"===e.key||" "===e.key){e.preventDefault();const t=l(i,e.currentTarget.dataset.index);$(t)}},L=e=>{e.id!==k&&(A((e=>e+1)),D(e.id),p(e),b&&(j(e.id),I(e)))},$=e=>{y&&e.nodes.length>0&&(C((t=>t.includes(e.id)?t.filter((t=>t!==e.id)):t.concat(e.id))),h(e)),e.id!==k&&(D(e.id),p(e)),j(e.id),I(e)};return React.createElement("ul",r({role:"tree"},w),i.map(((e,t)=>React.createElement(m,{key:e.id,node:e,index:`${t}`,selected:z,focused:k,expanded:K,setSize:i.length,counter:O,renderLabel:T,onItemSelect:$,onKeyDown:F}))))},b=t.forwardRef(y);var v=t.memo(b);const S=e=>{let{node:t,measureRef:n,start:r,isExpanded:d,isSelected:a,tabIndex:l,level:s,positionInSet:o,setSize:c,index:u,counter:f,isFocused:p,renderLabel:g,onItemSelect:x,onKeyDown:h}=e;return React.createElement("li",{ref:n,role:"treeitem",tabIndex:l,"aria-expanded":d,"aria-selected":a||null,"aria-level":s,"aria-posinset":o,"aria-setsize":c,"data-index":u,style:{position:"absolute",top:0,transform:`translateY(${r}px)`,"--level":s},onKeyDown:h},i(g)?g(t,{isExpanded:d,isExpandable:t.nodes.length>0}):React.createElement("div",{onClick:()=>x(t)},t.label))};var I=t.memo(S,((e,t)=>u(e,t,["measureRef","onItemSelect","onKeyDown"])));const T=(e,i)=>{let{nodes:c,defaultFocused:u,focused:g,onFocusChange:x=d,defaultExpanded:h=[],expanded:m,onExpandChange:y=d,selectionTogglesExpanded:b=!0,selectionFollowsFocus:v,defaultSelected:S,selected:T,onSelectChange:w=d,renderLabel:R,rowHeight:k=30,...D}=e;const K=a(g)?a(u)&&c.length>0?c[0].id:u:void 0,[C,z]=E(g,K),[j,O]=E(m,h),[A,F]=E(T,S),L=t.useRef(),$=t.useMemo((()=>((e,t)=>{const n=p(e,""),r=[];for(;n.length;){const e=n.pop();r.push(e),t.includes(e.id)&&n.push(...p(e.nodes,e[f]))}return r})(c,j)),[c,j]),q=n.useVirtual({estimateSize:t.useCallback((()=>k),[k]),size:$.length,parentRef:L,rangeExtractor(e){const t=n.defaultRangeExtractor(e),r=$.findIndex((e=>e.id===C));if(-1===r)return t;{let e=new Set(t);const n=$[r],d=s(c,n[f]);return d&&e.add($.findIndex((e=>e.id===d.id))),r>0&&e.add(r-1),e.add(r),r<$.length-1&&e.add(r+1),[...e]}}}),[V,H]=t.useState(0);t.useEffect((()=>{if(V>0){const e=$.findIndex((e=>e.id===C)),t=$[e],n=L.current.querySelector(`[data-index="${t[f]}"]`);q.scrollToIndex(e),n&&n.focus()}}),[V]),t.useImperativeHandle(i,(()=>({focus(){H((e=>e+1))}})));const M=e=>{b&&e.nodes.length>0&&(O((t=>t.includes(e.id)?t.filter((t=>t!==e.id)):t.concat(e.id))),y(e)),e.id!==C&&(z(e.id),x(e)),F(e.id),w(e)},P=e=>{if(c.length&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&e.target===e.currentTarget)if("ArrowUp"===e.key){if(e.preventDefault(),$[0].id!==C){const e=$.findIndex((e=>e.id===C)),t=$[e-1];U(t)}}else if("ArrowDown"===e.key){if(e.preventDefault(),$[$.length-1].id!==C){const e=$.findIndex((e=>e.id===C)),t=$[e+1];U(t)}}else if("ArrowLeft"===e.key){e.preventDefault();const{isExpandable:t,isExpanded:n}=o(e.currentTarget);if(t&&n){const e=$.findIndex((e=>e.id===C)),t=$[e];O((e=>e.filter((e=>e!==t.id)))),y(t),U(t)}else{const t=s(c,e.currentTarget.dataset.index);if(t){const e=$.findIndex((e=>e.id===t.id)),n=$[e];U(n)}}}else if("ArrowRight"===e.key){e.preventDefault();const{isExpandable:t,isExpanded:n}=o(e.currentTarget);if(t)if(n){const t=l(c,e.currentTarget.dataset.index).nodes[0],n=$.findIndex((e=>e.id===t.id)),r=$[n];U(r)}else{const e=$.findIndex((e=>e.id===C)),t=$[e];O((e=>e.concat(t.id))),y(t),U(t)}}else if("Enter"===e.key||" "===e.key){e.preventDefault();const t=l(c,e.currentTarget.dataset.index);M(t)}},U=e=>{e.id!==C&&(H((e=>e+1)),z(e.id),x(e),v&&(F(e.id),w(e)))},_=t.useMemo((()=>({height:q.totalSize+"px",position:"relative",margin:0,padding:0})),[q.totalSize]);return React.createElement("div",r({},D,{ref:L}),React.createElement("ul",{role:"tree",style:_},q.virtualItems.map((e=>{const t=$[e.index],n=t[f].split("-"),r=n.length,d=parseInt(n[n.length-1],10)+1,i=1===n.length?c.length:s(c,t[f]).nodes.length,a=t.nodes.length>0?j.includes(t.id):null;return React.createElement(I,{key:e.index,node:t,measureRef:e.measureRef,start:e.start,isExpanded:a,isSelected:A===t.id,tabIndex:C===t.id?0:-1,level:r,positionInSet:d,setSize:i,index:t[f],renderLabel:R,onItemSelect:M,onKeyDown:P})}))))},w=t.forwardRef(T);var R=t.memo(w);e.Tree=v,e.VirtualTree=R,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=react-crann.umd.min.js.map
