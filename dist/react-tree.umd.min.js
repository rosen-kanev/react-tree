!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("react-virtual"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","react-virtual","prop-types"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactTree={},e.React,e.ReactVirtual)}(this,(function(e,t,n){"use strict";function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}const d=()=>{},l=e=>"function"==typeof e,i=e=>void 0===e,a=(e,t)=>{const n=t.split("-");let r={nodes:e},d=0;for(;null!=r&&d<n.length;)r=r.nodes[n[d++]];return d&&d===n.length?r:void 0},s=(e,t)=>{if(e.dataset.index.split("-").length>1){const n=e.parentElement.parentElement;return[n,a(t,n.dataset.index)]}return[null,null]},o=e=>{const t=e.getAttribute("aria-expanded");return{isExpandable:null!==t,isExpanded:"true"===t}},c=(e,t)=>{const n=e.dataset.index.split("-");return 1===n.length&&parseInt(n[0],10)===t.length-1},u=(e,t,n)=>{if(Object.is(e,t))return!0;const r=Object.keys(e).filter((e=>!n.includes(e))),d=Object.keys(t).filter((e=>!n.includes(e)));if(r.length!==d.length)return!1;for(const n of r)if(!Object.prototype.hasOwnProperty.call(t,n)||!Object.is(e[n],t[n]))return!1;return!0},f=Symbol("id"),p=(e,t)=>{let n=[],r=e.length-1;for(;r>=0;)n.push({...e[r],[f]:t?`${t}-${r}`:`${r}`}),r--;return n},x=e=>{let{node:n,index:r,selected:d,focused:i,expanded:a,setSize:s,counter:o,onItemSelect:c,renderLabel:u,onKeyDown:f}=e;const p=n.nodes.length>0,x=p?a.includes(n.id):null,g=r.split("-"),m=parseInt(g[g.length-1],10)+1,E=t.useRef();return t.useEffect((()=>{o>0&&i===n.id&&E.current&&(E.current.focus(),E.current.firstElementChild.scrollIntoView({block:"nearest"}))}),[o]),React.createElement("li",{ref:E,role:"treeitem",tabIndex:i===n.id?0:-1,"aria-expanded":x,"aria-selected":d===n.id||null,"aria-level":g.length,"aria-posinset":m,"aria-setsize":s,"data-index":r,onKeyDown:f},l(u)?u(n,{isExpandable:p,isExpanded:x}):React.createElement("div",{onClick:()=>c(n)},n.label),x&&p&&React.createElement("ul",{role:"group"},n.nodes.map(((e,t)=>React.createElement(h,{key:e.id,node:e,index:r+"-"+t,selected:d,focused:i,expanded:a,setSize:e.nodes.length,counter:o,renderLabel:u,onItemSelect:c,onKeyDown:f})))))},g=(e,t)=>{if(!u(e,t,["counter","selected","focused","expanded","onItemSelect","onKeyDown"]))return!1;const n=[{...t.node,nodes:[]},...t.node.nodes];for(;n.length;){const r=n.shift();if(r.id===t.focused||r.id===e.focused)return!1;if(r.id===t.selected||r.id===e.selected)return!1;if(e.expanded.includes(r.id)!==t.expanded.includes(r.id))return!1;n.push(...r.nodes)}return!0},h=t.memo(x,g);var m=h;var E=(e,n)=>{const[r,d]=t.useState(n),l=i(e),a=l?r:e;return[a,t.useCallback((e=>{l&&d(e)}),[l,a])]};const y=(e,n)=>{let{nodes:l,defaultFocused:u,focused:f,onFocusChange:p=d,defaultExpanded:x=[],expanded:g,onExpandChange:h=d,selectionTogglesExpanded:y=!0,selectionFollowsFocus:b,defaultSelected:v,selected:S,onSelectChange:I=d,renderLabel:w,...R}=e;const k=i(f)?i(u)&&l.length>0?l[0].id:u:void 0,[D,T]=E(f,k),[C,K]=E(g,x),[j,z]=E(S,v),[O,A]=t.useState(0);t.useImperativeHandle(n,(()=>({focus(){A((e=>e+1))}})));const F=e=>{if(l.length&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&e.target===e.currentTarget)if("ArrowUp"===e.key){e.preventDefault();const[t,n]=((e,t)=>{if("0"===e.dataset.index)return[null,null];if(e.previousElementSibling){let n=e.previousElementSibling;for(;;){const{isExpanded:e,isExpandable:t}=o(n);if(!t||!e)break;n=n.lastElementChild.lastElementChild}return[n,a(t,n.dataset.index)]}return s(e,t)})(e.currentTarget,l);t&&L(t,n)}else if("ArrowDown"===e.key){e.preventDefault();const[t,n]=((e,t)=>{let n=e;const{isExpanded:r}=o(e);if(r)n=e.lastElementChild.firstElementChild;else for(;;){if(c(n,t))return[null,null];if(n.nextElementSibling){n=n.nextElementSibling;break}n=n.parentElement.parentElement}return[n,a(t,n.dataset.index)]})(e.currentTarget,l);t&&L(t,n)}else if("ArrowLeft"===e.key){e.preventDefault();const[t,n]=((e,t)=>{const{isExpandable:n,isExpanded:r}=o(e),d=e.dataset.index;return n&&r?[null,a(t,d)]:s(e,t)})(e.currentTarget,l);t&&L(t,n),!t&&n&&(K((e=>e.filter((e=>e!==n.id)))),h(n))}else if("ArrowRight"===e.key){e.preventDefault();const[t,n]=((e,t)=>{const{isExpandable:n,isExpanded:r}=o(e);if(n){const n=e.dataset.index,d=a(t,n);return r?[e.lastElementChild.firstElementChild,d.nodes[0]]:[null,d]}return[null,null]})(e.currentTarget,l);t&&L(t,n),!t&&n&&(K((e=>e.concat(n.id))),h(n))}else if("Enter"===e.key||" "===e.key){e.preventDefault();const t=a(l,e.currentTarget.dataset.index);P(t)}},L=(e,t)=>{A((e=>e+1)),T(t.id),p(t),b&&(z(t.id),I(t))},P=e=>{y&&e.nodes.length>0&&(K((t=>t.includes(e.id)?t.filter((t=>t!==e.id)):t.concat(e.id))),h(e)),e.id!==D&&(T(e.id),p(e)),z(e.id),I(e)};return React.createElement("ul",r({role:"tree"},R),l.map(((e,t)=>React.createElement(m,{key:e.id,node:e,index:`${t}`,selected:j,focused:D,expanded:C,setSize:l.length,counter:O,renderLabel:w,onItemSelect:P,onKeyDown:F}))))},b=t.forwardRef(y);var v=t.memo(b);const S=e=>{let{node:t,measureRef:n,start:r,isExpanded:d,isSelected:i,tabIndex:a,level:s,positionInSet:o,setSize:c,index:u,counter:f,isFocused:p,renderLabel:x,onItemSelect:g,onKeyDown:h}=e;return React.createElement("li",{ref:n,role:"treeitem",tabIndex:a,"aria-expanded":d,"aria-selected":i||null,"aria-level":s,"aria-posinset":o,"aria-setsize":c,"data-index":u,style:{position:"absolute",top:0,transform:`translateY(${r}px)`,"--level":s},onKeyDown:h},l(x)?x(t,{isExpanded:d,isExpandable:t.nodes.length>0}):React.createElement("div",{onClick:()=>g(t)},t.label))};var I=t.memo(S,((e,t)=>u(e,t,["measureRef","onItemSelect","onKeyDown"])));const w=(e,l)=>{let{nodes:s,defaultFocused:c,focused:u,onFocusChange:x=d,defaultExpanded:g=[],expanded:h,onExpandChange:m=d,selectionTogglesExpanded:y=!0,selectionFollowsFocus:b,defaultSelected:v,selected:S,onSelectChange:w=d,renderLabel:R,rowHeight:k=30,...D}=e;const T=i(u)?i(c)&&s.length>0?s[0].id:c:void 0,[C,K]=E(u,T),[j,z]=E(h,g),[O,A]=E(S,v),F=t.useRef(),L=t.useMemo((()=>((e,t)=>{const n=p(e,""),r=[];for(;n.length;){const e=n.pop();r.push(e),t.includes(e.id)&&n.push(...p(e.nodes,e[f]))}return r})(s,j)),[s,j]),P=n.useVirtual({estimateSize:t.useCallback((()=>k),[k]),size:L.length,parentRef:F,rangeExtractor(e){const t=n.defaultRangeExtractor(e),r=L.findIndex((e=>e.id===C));if(-1===r)return t;{let e=new Set(t);const n=L[r][f].split("-"),d=n.length>1?a(s,n.slice(0,-1).join("-")):null;return d&&e.add(L.findIndex((e=>e.id===d.id))),r>0&&e.add(r-1),e.add(r),r<L.length-1&&e.add(r+1),[...e]}}}),[$,q]=t.useState(0);t.useEffect((()=>{if($>0){const e=L.findIndex((e=>e.id===C)),t=L[e],n=F.current.querySelector(`[data-index="${t[f]}"]`);P.scrollToIndex(e),n&&n.focus()}}),[$]),t.useImperativeHandle(l,(()=>({focus(){q((e=>e+1))}})));const V=e=>{y&&e.nodes.length>0&&(z((t=>t.includes(e.id)?t.filter((t=>t!==e.id)):t.concat(e.id))),m(e)),e.id!==C&&(K(e.id),x(e)),A(e.id),w(e)},H=e=>{if(s.length&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&e.target===e.currentTarget)if("ArrowUp"===e.key){if(e.preventDefault(),e.stopPropagation(),L[0].id!==C){const e=L.findIndex((e=>e.id===C)),t=L[e-1];M(t)}}else if("ArrowDown"===e.key){if(e.preventDefault(),e.stopPropagation(),L[L.length-1].id!==C){const e=L.findIndex((e=>e.id===C)),t=L[e+1];M(t)}}else if("ArrowLeft"===e.key){e.preventDefault(),e.stopPropagation();const{isExpandable:t,isExpanded:n}=o(e.currentTarget);if(t&&n){const e=L.findIndex((e=>e.id===C)),t=L[e];z((e=>e.filter((e=>e!==t.id)))),m(t),M(t)}else{const t=e.currentTarget.dataset.index.split("-");if(t.length>1){const e=a(s,t.slice(0,-1).join("-")),n=L.findIndex((t=>t.id===e.id)),r=L[n];M(r)}}}else if("ArrowRight"===e.key){e.preventDefault(),e.stopPropagation();const{isExpandable:t,isExpanded:n}=o(e.currentTarget);if(t)if(n){const t=a(s,e.currentTarget.dataset.index).nodes[0],n=L.findIndex((e=>e.id===t.id)),r=L[n];M(r)}else{const e=L.findIndex((e=>e.id===C)),t=L[e];z((e=>e.concat(t.id))),m(t),M(t)}}else if("Enter"===e.key||" "===e.key){e.preventDefault(),e.stopPropagation();const t=a(s,e.currentTarget.dataset.index);V(t)}},M=e=>{e.id!==C&&(q((e=>e+1)),K(e.id),x(e)),b&&(A(e.id),w(e))},U=t.useMemo((()=>({height:P.totalSize+"px",position:"relative",margin:0,padding:0})),[P.totalSize]);return React.createElement("div",r({},D,{ref:F}),React.createElement("ul",{role:"tree",style:U},P.virtualItems.map((e=>{const t=L[e.index],n=t[f].split("-"),r=n.length,d=parseInt(n[n.length-1],10)+1,l=1===n.length?s.length:a(s,n.slice(0,-1).join("-")).nodes.length,i=t.nodes.length>0?j.includes(t.id):null;return React.createElement(I,{key:e.index,node:t,measureRef:e.measureRef,start:e.start,isExpanded:i,isSelected:O===t.id,tabIndex:C===t.id?0:-1,level:r,positionInSet:d,setSize:l,index:t[f],renderLabel:R,onItemSelect:V,onKeyDown:H})}))))},R=t.forwardRef(w);var k=t.memo(R);e.Tree=v,e.VirtualTree=k,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=react-tree.umd.min.js.map
