!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("react-virtual"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","react-virtual","prop-types"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactTree={},e.React,e.ReactVirtual)}(this,(function(e,t,n){"use strict";function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}const l=()=>{},i=e=>"function"==typeof e,d=e=>void 0===e,a=(e,t)=>{const n=t.split("-");let r={nodes:e},l=0;for(;null!=r&&l<n.length;)r=r.nodes[n[l++]];return l&&l===n.length?r:void 0},s=(e,t)=>{if(e.dataset.index.split("-").length>1){const n=e.parentElement.parentElement;return[n,a(t,n.dataset.index)]}return[null,null]},o=e=>{const t=e.getAttribute("aria-expanded");return{isExpandable:null!==t,isExpanded:"true"===t}},c=(e,t)=>{const n=e.dataset.index.split("-");return 1===n.length&&parseInt(n[0],10)===t.length-1},u=(e,t,n)=>{if(Object.is(e,t))return!0;const r=Object.keys(e).filter((e=>!n.includes(e))),l=Object.keys(t).filter((e=>!n.includes(e)));if(r.length!==l.length)return!1;for(const n of r)if(!Object.prototype.hasOwnProperty.call(t,n)||!Object.is(e[n],t[n]))return!1;return!0},f=Symbol("id"),p=(e,t)=>{let n=[],r=e.length-1;for(;r>=0;)n.push({...e[r],[f]:t?`${t}-${r}`:`${r}`}),r--;return n},x=e=>{let{onItemSelect:n,renderLabel:l,focused:d,selected:a,expanded:s,index:o,setSize:c,counter:u,onKeyDown:f,...p}=e;const x=p.nodes.length>0,g=x?s.includes(p.id):null,m=o.split("-"),E=parseInt(m[m.length-1],10)+1,y=t.useRef();return t.useEffect((()=>{u>0&&d===p.id&&y.current&&(y.current.focus(),y.current.firstElementChild.scrollIntoView({block:"nearest"}))}),[u]),React.createElement("li",{ref:y,role:"treeitem",tabIndex:d===p.id?0:-1,"aria-expanded":g,"aria-selected":a===p.id||null,"aria-level":m.length,"aria-posinset":E,"aria-setsize":c,"data-index":o,onKeyDown:f},i(l)?l(p,{isExpandable:x,isExpanded:g}):React.createElement("div",{onClick:()=>n(p)},p.label),g&&x&&React.createElement("ul",{role:"group"},p.nodes.map(((e,t)=>React.createElement(h,r({},e,{key:e.id,index:o+"-"+t,selected:a,focused:d,expanded:s,setSize:p.nodes.length,counter:u,renderLabel:l,onItemSelect:n,onKeyDown:f}))))))},g=(e,t)=>{if(!u(e,t,["counter","selected","focused","expanded","onItemSelect","onKeyDown"]))return!1;const n=[{...t,nodes:[]},...t.nodes];for(;n.length;){const r=n.shift();if(r.id===t.focused||r.id===e.focused)return!1;if(r.id===t.selected||r.id===e.selected)return!1;if(e.expanded.includes(r.id)!==t.expanded.includes(r.id))return!1;n.push(...r.nodes)}return!0},h=t.memo(x,g);var m=h;var E=(e,n)=>{const[r,l]=t.useState(n),i=d(e),a=i?r:e;return[a,t.useCallback((e=>{i&&l(e)}),[i,a])]};const y=(e,n)=>{let{nodes:i,defaultFocused:u,focused:f,onFocusChange:p=l,defaultExpanded:x=[],expanded:g,onExpandChange:h=l,selectionTogglesExpanded:y=!0,selectionFollowsFocus:b,defaultSelected:v,selected:S,onSelectChange:I=l,renderLabel:w,...R}=e;const k=d(f)?d(u)&&i.length>0?i[0].id:u:void 0,[D,T]=E(f,k),[C,K]=E(g,x),[j,z]=E(S,v),[O,A]=t.useState(0);t.useImperativeHandle(n,(()=>({focus(){A((e=>e+1))}})));const F=e=>{if(i.length&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&e.target===e.currentTarget)if("ArrowUp"===e.key){e.preventDefault();const[t,n]=((e,t)=>{if("0"===e.dataset.index)return[null,null];if(e.previousElementSibling){let n=e.previousElementSibling;for(;;){const{isExpanded:e,isExpandable:t}=o(n);if(!t||!e)break;n=n.lastElementChild.lastElementChild}return[n,a(t,n.dataset.index)]}return s(e,t)})(e.currentTarget,i);t&&L(t,n)}else if("ArrowDown"===e.key){e.preventDefault();const[t,n]=((e,t)=>{let n=e;const{isExpanded:r}=o(e);if(r)n=e.lastElementChild.firstElementChild;else for(;;){if(c(n,t))return[null,null];if(n.nextElementSibling){n=n.nextElementSibling;break}n=n.parentElement.parentElement}return[n,a(t,n.dataset.index)]})(e.currentTarget,i);t&&L(t,n)}else if("ArrowLeft"===e.key){e.preventDefault();const[t,n]=((e,t)=>{const{isExpandable:n,isExpanded:r}=o(e),l=e.dataset.index;return n&&r?[null,a(t,l)]:s(e,t)})(e.currentTarget,i);t&&L(t,n),!t&&n&&(K((e=>e.filter((e=>e!==n.id)))),h(n))}else if("ArrowRight"===e.key){e.preventDefault();const[t,n]=((e,t)=>{const{isExpandable:n,isExpanded:r}=o(e);if(n){const n=e.dataset.index,l=a(t,n);return r?[e.lastElementChild.firstElementChild,l.nodes[0]]:[null,l]}return[null,null]})(e.currentTarget,i);t&&L(t,n),!t&&n&&(K((e=>e.concat(n.id))),h(n))}else if("Enter"===e.key||" "===e.key){e.preventDefault();const t=a(i,e.currentTarget.dataset.index);P(t)}},L=(e,t)=>{A((e=>e+1)),T(t.id),p(t),b&&(z(t.id),I(t))},P=e=>{y&&e.nodes.length>0&&(K((t=>t.includes(e.id)?t.filter((t=>t!==e.id)):t.concat(e.id))),h(e)),e.id!==D&&(T(e.id),p(e)),z(e.id),I(e)};return React.createElement("ul",r({role:"tree"},R),i.map(((e,t)=>React.createElement(m,r({},e,{key:e.id,index:`${t}`,selected:j,focused:D,expanded:C,setSize:i.length,counter:O,renderLabel:w,onItemSelect:P,onKeyDown:F})))))},b=t.forwardRef(y);var v=t.memo(b);const S=e=>{let{measureRef:t,start:n,isExpanded:r,isSelected:l,tabIndex:d,level:a,positionInSet:s,setSize:o,index:c,counter:u,isFocused:f,renderLabel:p,onItemSelect:x,onKeyDown:g,...h}=e;return React.createElement("li",{ref:t,role:"treeitem",tabIndex:d,"aria-expanded":r,"aria-selected":l||null,"aria-level":a,"aria-posinset":s,"aria-setsize":o,"data-index":c,style:{position:"absolute",top:0,transform:`translateY(${n}px)`,"--level":a},onKeyDown:g},i(p)?p(h,{isExpanded:r,isExpandable:h.nodes.length>0}):React.createElement("div",{onClick:()=>x(h)},h.label))};var I=t.memo(S,((e,t)=>u(e,t,["measureRef","onItemSelect","onKeyDown"])));const w=(e,i)=>{let{nodes:s,defaultFocused:c,focused:u,onFocusChange:x=l,defaultExpanded:g=[],expanded:h,onExpandChange:m=l,selectionTogglesExpanded:y=!0,selectionFollowsFocus:b,defaultSelected:v,selected:S,onSelectChange:w=l,renderLabel:R,rowHeight:k=30,...D}=e;const T=d(u)?d(c)&&s.length>0?s[0].id:c:void 0,[C,K]=E(u,T),[j,z]=E(h,g),[O,A]=E(S,v),F=t.useRef(),L=t.useMemo((()=>((e,t)=>{const n=p(e,""),r=[];for(;n.length;){const e=n.pop();r.push(e),t.includes(e.id)&&n.push(...p(e.nodes,e[f]))}return r})(s,j)),[s,j]),P=n.useVirtual({estimateSize:t.useCallback((()=>k),[k]),size:L.length,parentRef:F,rangeExtractor(e){const t=n.defaultRangeExtractor(e),r=L.findIndex((e=>e.id===C));if(-1===r)return t;{let e=new Set(t);const n=L[r][f].split("-"),l=n.length>1?a(s,n.slice(0,-1).join("-")):null;return l&&e.add(L.findIndex((e=>e.id===l.id))),r>0&&e.add(r-1),e.add(r),r<L.length-1&&e.add(r+1),[...e]}}}),[$,q]=t.useState(0);t.useEffect((()=>{if($>0){const e=L.findIndex((e=>e.id===C)),t=L[e],n=F.current.querySelector(`[data-index="${t[f]}"]`);P.scrollToIndex(e),n&&n.focus()}}),[$]),t.useImperativeHandle(i,(()=>({focus(){q((e=>e+1))}})));const V=e=>{y&&e.nodes.length>0&&(z((t=>t.includes(e.id)?t.filter((t=>t!==e.id)):t.concat(e.id))),m(e)),e.id!==C&&(K(e.id),x(e)),A(e.id),w(e)},H=e=>{if(s.length&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&e.target===e.currentTarget)if("ArrowUp"===e.key){if(e.preventDefault(),e.stopPropagation(),L[0].id!==C){const e=L.findIndex((e=>e.id===C)),t=L[e-1];M(t)}}else if("ArrowDown"===e.key){if(e.preventDefault(),e.stopPropagation(),L[L.length-1].id!==C){const e=L.findIndex((e=>e.id===C)),t=L[e+1];M(t)}}else if("ArrowLeft"===e.key){e.preventDefault(),e.stopPropagation();const{isExpandable:t,isExpanded:n}=o(e.currentTarget);if(t&&n){const e=L.findIndex((e=>e.id===C)),t=L[e];z((e=>e.filter((e=>e!==t.id)))),m(t),M(t)}else{const t=e.currentTarget.dataset.index.split("-");if(t.length>1){const e=a(s,t.slice(0,-1).join("-")),n=L.findIndex((t=>t.id===e.id)),r=L[n];M(r)}}}else if("ArrowRight"===e.key){e.preventDefault(),e.stopPropagation();const{isExpandable:t,isExpanded:n}=o(e.currentTarget);if(t)if(n){const t=a(s,e.currentTarget.dataset.index).nodes[0],n=L.findIndex((e=>e.id===t.id)),r=L[n];M(r)}else{const e=L.findIndex((e=>e.id===C)),t=L[e];z((e=>e.concat(t.id))),m(t),M(t)}}else if("Enter"===e.key||" "===e.key){e.preventDefault(),e.stopPropagation();const t=a(s,e.currentTarget.dataset.index);V(t)}},M=e=>{e.id!==C&&(q((e=>e+1)),K(e.id),x(e)),b&&(A(e.id),w(e))},U=t.useMemo((()=>({height:P.totalSize+"px",position:"relative",margin:0,padding:0})),[P.totalSize]);return React.createElement("div",r({},D,{ref:F}),React.createElement("ul",{role:"tree",style:U},P.virtualItems.map((e=>{const t=L[e.index],n=t[f].split("-"),l=n.length,i=parseInt(n[n.length-1],10)+1,d=1===n.length?s.length:a(s,n.slice(0,-1).join("-")).nodes.length,o=t.nodes.length>0?j.includes(t.id):null;return React.createElement(I,r({},t,{key:e.index,measureRef:e.measureRef,start:e.start,isExpanded:o,isSelected:O===t.id,tabIndex:C===t.id?0:-1,level:l,positionInSet:i,setSize:d,index:t[f],renderLabel:R,onItemSelect:V,onKeyDown:H}))}))))},R=t.forwardRef(w);var k=t.memo(R);e.Tree=v,e.VirtualTree=k,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=react-tree.umd.min.js.map
