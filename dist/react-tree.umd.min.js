!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("react-virtual"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","react-virtual","prop-types"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReactTree={},e.React,e.ReactVirtual)}(this,(function(e,t,n){"use strict";function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}const l=()=>{},i=e=>"function"==typeof e,d=e=>void 0===e,a=(e,t)=>{const n=t.split("-");let r={nodes:e},l=0;for(;null!=r&&l<n.length;)r=r.nodes[n[l++]];return l&&l===n.length?r:void 0},s=(e,t)=>{if(e.dataset.index.split("-").length>1){const n=e.parentElement.parentElement;return[n,a(t,n.dataset.index)]}return[null,null]},o=e=>{const t=e.getAttribute("aria-expanded");return{isExpandable:null!==t,isExpanded:"true"===t}},c=(e,t)=>{const n=e.dataset.index.split("-");return 1===n.length&&parseInt(n[0],10)===t.length-1},u=(e,t,n)=>{if(Object.is(e,t))return!0;const r=Object.keys(e).filter((e=>!n.includes(e))),l=Object.keys(t).filter((e=>!n.includes(e)));if(r.length!==l.length)return!1;for(const n of r)if(!Object.prototype.hasOwnProperty.call(t,n)||!Object.is(e[n],t[n]))return!1;return!0},f=Symbol("id"),p=(e,t)=>{let n=[],r=e.length-1;for(;r>=0;)n.push({...e[r],[f]:t?`${t}-${r}`:`${r}`}),r--;return n},g=e=>{let{onItemSelect:n,renderLabel:l,focused:d,selected:a,expanded:s,index:o,setSize:c,counter:u,onKeyDown:f,...p}=e;const g=p.nodes.length>0,x=g?s.includes(p.id):null,m=o.split("-"),E=parseInt(m[m.length-1],10)+1,y=t.useRef();return t.useEffect((()=>{u>0&&d===p.id&&y.current&&(y.current.focus(),y.current.firstElementChild.scrollIntoView({block:"nearest"}))}),[u]),React.createElement("li",{ref:y,role:"treeitem",tabIndex:d===p.id?0:-1,"aria-expanded":x,"aria-selected":a===p.id||null,"aria-level":m.length,"aria-posinset":E,"aria-setsize":c,"data-index":o,onKeyDown:f},i(l)?l(p,{isExpandable:g,isExpanded:x}):React.createElement("div",{onClick:()=>n(p)},p.label),x&&g&&React.createElement("ul",{role:"group"},p.nodes.map(((e,t)=>React.createElement(h,r({},e,{key:e.id,index:o+"-"+t,selected:a,focused:d,expanded:s,setSize:p.nodes.length,counter:u,renderLabel:l,onItemSelect:n,onKeyDown:f}))))))},x=(e,t)=>{if(!u(e,t,["counter","selected","focused","expanded","onItemSelect","onKeyDown"]))return!1;const n=[{...t,nodes:[]},...t.nodes];for(;n.length;){const r=n.shift();if(r.id===t.focused||r.id===e.focused)return!1;if(r.id===t.selected||r.id===e.selected)return!1;if(e.expanded.includes(r.id)!==t.expanded.includes(r.id))return!1;n.push(...r.nodes)}return!0},h=t.memo(g,x);var m=h;var E=(e,n)=>{const[r,l]=t.useState(n),i=d(e),a=i?r:e;return[a,t.useCallback((e=>{i&&l(e)}),[i,a])]};const y=(e,n)=>{let{nodes:i,defaultFocused:u,focused:f,onFocusChange:p=l,defaultExpanded:g=[],expanded:x,onExpandChange:h=l,selectionTogglesExpanded:y=!0,selectionFollowsFocus:b,defaultSelected:v,selected:S,onSelectChange:I=l,renderLabel:w,...R}=e;const k=d(f)?d(u)&&i.length>0?i[0].id:u:void 0,[D,T]=E(f,k),[C,K]=E(x,g),[j,z]=E(S,v),[O,F]=t.useState(0);t.useImperativeHandle(n,(()=>({focus(){F((e=>e+1))}})));const A=e=>{if(i.length&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&e.target===e.currentTarget)if("ArrowUp"===e.key){e.preventDefault();const[t,n]=((e,t)=>{if("0"===e.dataset.index)return[null,null];if(e.previousElementSibling){let n=e.previousElementSibling;for(;;){const{isExpanded:e,isExpandable:t}=o(n);if(!t||!e)break;n=n.lastElementChild.lastElementChild}return[n,a(t,n.dataset.index)]}return s(e,t)})(e.currentTarget,i);t&&L(t,n)}else if("ArrowDown"===e.key){e.preventDefault();const[t,n]=((e,t)=>{let n=e;const{isExpanded:r}=o(e);if(r)n=e.lastElementChild.firstElementChild;else for(;;){if(c(n,t))return[null,null];if(n.nextElementSibling){n=n.nextElementSibling;break}n=n.parentElement.parentElement}return[n,a(t,n.dataset.index)]})(e.currentTarget,i);t&&L(t,n)}else if("ArrowLeft"===e.key){e.preventDefault();const[t,n]=((e,t)=>{const{isExpandable:n,isExpanded:r}=o(e),l=e.dataset.index;return n&&r?[null,a(t,l)]:s(e,t)})(e.currentTarget,i);t&&L(t,n),!t&&n&&(K((e=>e.filter((e=>e!==n.id)))),h(n))}else if("ArrowRight"===e.key){e.preventDefault();const[t,n]=((e,t)=>{const{isExpandable:n,isExpanded:r}=o(e);if(n){const n=e.dataset.index,l=a(t,n);return r?[e.lastElementChild.firstElementChild,l.nodes[0]]:[null,l]}return[null,null]})(e.currentTarget,i);t&&L(t,n),!t&&n&&(K((e=>e.concat(n.id))),h(n))}else if("Enter"===e.key||" "===e.key){e.preventDefault();const t=a(i,e.currentTarget.dataset.index);P(t)}},L=(e,t)=>{F((e=>e+1)),T(t.id),p(t),b&&(z(t.id),I(t))},P=e=>{y&&e.nodes.length>0&&(K((t=>t.includes(e.id)?t.filter((t=>t!==e.id)):t.concat(e.id))),h(e)),e.id!==D&&(T(e.id),p(e)),z(e.id),I(e)};return React.createElement("ul",r({role:"tree"},R),i.map(((e,t)=>React.createElement(m,r({},e,{key:e.id,index:`${t}`,selected:j,focused:D,expanded:C,setSize:i.length,counter:O,renderLabel:w,onItemSelect:P,onKeyDown:A})))))},b=t.forwardRef(y);var v=t.memo(b);const S=e=>{let{measureRef:t,start:n,isExpanded:r,isSelected:l,tabIndex:d,level:a,positionInSet:s,setSize:o,index:c,renderLabel:u,onItemSelect:f,onKeyDown:p,...g}=e;return React.createElement("li",{ref:t,role:"treeitem",tabIndex:d,"aria-expanded":r,"aria-selected":l||null,"aria-level":a,"aria-posinset":s,"aria-setsize":o,"data-index":c,style:{position:"absolute",top:0,transform:`translateY(${n}px)`,"--level":a},onKeyDown:p},i(u)?u(g,{isExpanded:r,isExpandable:g.nodes.length>0}):React.createElement("div",{onClick:()=>f(g)},g.label))};var I=t.memo(S,((e,t)=>u(e,t,["measureRef","onItemSelect","onKeyDown"])));const w=e=>{let{nodes:i,defaultFocused:s,focused:c,onFocusChange:u=l,defaultExpanded:g=[],expanded:x,onExpandChange:h=l,selectionTogglesExpanded:m=!0,selectionFollowsFocus:y,shouldFocusElementOnFocusedChange:b=!0,defaultSelected:v,selected:S,onSelectChange:w=l,renderLabel:R,rowHeight:k=30,...D}=e;const T=d(c)?d(s)&&i.length>0?i[0].id:s:void 0,[C,K]=E(c,T),[j,z]=E(x,g),[O,F]=E(S,v),A=t.useRef(!1),L=t.useRef(),P=t.useMemo((()=>((e,t)=>{const n=p(e,""),r=[];for(;n.length;){const e=n.pop();r.push(e),t.includes(e.id)&&n.push(...p(e.nodes,e[f]))}return r})(i,j)),[i,j]),$=n.useVirtual({estimateSize:t.useCallback((()=>k),[k]),size:P.length,parentRef:L,rangeExtractor(e){const t=n.defaultRangeExtractor(e),r=P.findIndex((e=>e.id===C));if(-1===r)return t;{let e=new Set(t);const n=P[r][f].split("-"),l=n.length>1?a(i,n.slice(0,-1).join("-")):null;return l&&e.add(P.findIndex((e=>e.id===l.id))),r>0&&e.add(r-1),e.add(r),r<P.length-1&&e.add(r+1),[...e]}}});t.useEffect((()=>{const e=A.current;if(A.current||(A.current=!0),e&&b){var t;const e=P.findIndex((e=>e.id===C)),n=P[e];$.scrollToIndex(e),null==(t=L.current.querySelector(`[data-index="${n[f]}"]`))||t.focus()}}),[C]);const q=e=>{e.id!==C&&(K(e.id),u(e)),y&&e.id!==O&&(F(e.id),w(e))},V=e=>{m&&e.nodes.length>0&&(z((t=>t.includes(e.id)?t.filter((t=>t!==e.id)):t.concat(e.id))),h(e)),e.id!==C&&(K(e.id),u(e)),e.id!==O&&(F(e.id),w(e))},M=e=>{if(i.length&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&e.target===e.currentTarget)if("ArrowUp"===e.key){if(e.preventDefault(),e.stopPropagation(),P[0].id!==C){const e=P.findIndex((e=>e.id===C)),t=P[e-1];q(t)}}else if("ArrowDown"===e.key){if(e.preventDefault(),e.stopPropagation(),P[P.length-1].id!==C){const e=P.findIndex((e=>e.id===C)),t=P[e+1];q(t)}}else if("ArrowLeft"===e.key){e.preventDefault(),e.stopPropagation();const{isExpandable:t,isExpanded:n}=o(e.currentTarget);if(t&&n){const e=P.findIndex((e=>e.id===C)),t=P[e];z((e=>e.filter((e=>e!==t.id)))),h(t),q(t)}else{const t=e.currentTarget.dataset.index.split("-");if(t.length>1){const e=a(i,t.slice(0,-1).join("-")),n=P.findIndex((t=>t.id===e.id)),r=P[n];q(r)}}}else if("ArrowRight"===e.key){e.preventDefault(),e.stopPropagation();const{isExpandable:t,isExpanded:n}=o(e.currentTarget);if(t)if(n){const t=a(i,e.currentTarget.dataset.index).nodes[0],n=P.findIndex((e=>e.id===t.id)),r=P[n];q(r)}else{const e=P.findIndex((e=>e.id===C)),t=P[e];z((e=>e.concat(t.id))),h(t),q(t)}}else if("Enter"===e.key||" "===e.key){e.preventDefault(),e.stopPropagation();const t=a(i,e.currentTarget.dataset.index);V(t)}},H=t.useMemo((()=>({height:$.totalSize+"px",position:"relative",margin:0,padding:0})),[$.totalSize]);return React.createElement("div",r({},D,{ref:L}),React.createElement("ul",{role:"tree",style:H},$.virtualItems.map((e=>{const t=P[e.index],n=t[f].split("-"),l=n.length,d=parseInt(n[n.length-1],10)+1,s=1===n.length?i.length:a(i,n.slice(0,-1).join("-")).nodes.length,o=t.nodes.length>0?j.includes(t.id):null;return React.createElement(I,r({},t,{key:e.index,measureRef:e.measureRef,start:e.start,isExpanded:o,isSelected:O===t.id,tabIndex:C===t.id?0:-1,level:l,positionInSet:d,setSize:s,index:t[f],renderLabel:R,onItemSelect:V,onKeyDown:M}))}))))};var R=t.memo(w);e.Tree=v,e.VirtualTree=R,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=react-tree.umd.min.js.map
